machine:
  ruby:
    version: 2.3.0

checkout:
  post:
    # we have request logs on Concierge, which includes request logs on the test
    # environment. However, the +log+ directory is not kept under source control.
    # This ensures that we will have a +log+ directory on Circle before running the
    # tests, allowing the log file to be created.
    - mkdir log

database:
  override:
    - mv .env.example .env
    - sudo -u postgres createdb concierge_development

      # the +external_errors+ database table requires the PostgreSQL specific
      # +hstore+ extension. This runs a command to load the extension on the
      # database specified on the +.env.example+ file so that migrations can
      # be successfully performed on Circle's environment.
    - sudo -u postgres psql -d concierge_development -c 'CREATE EXTENSION hstore;'
    - bundle exec hanami db migrate
